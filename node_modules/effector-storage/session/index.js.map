{"version":3,"file":"index.js","sources":["../../src/session/index.ts"],"sourcesContent":["import type { Subscription } from 'effector'\nimport type {\n  ConfigPersist as BaseConfigPersist,\n  ConfigStore as BaseConfigStore,\n  ConfigSourceTarget as BaseConfigSourceTarget,\n  StorageAdapter,\n} from '../types'\nimport { persist as base } from '../core'\nimport { nil } from '../nil'\nimport { storage } from '../storage'\n\nexport type {\n  Contract,\n  Done,\n  Fail,\n  Finally,\n  StorageAdapter,\n  StorageAdapterFactory,\n} from '../types'\n\nexport interface ConfigPersist extends BaseConfigPersist {\n  sync?: boolean | 'force'\n  timeout?: number\n}\n\nexport interface SessionStorageConfig {\n  sync?: boolean | 'force'\n  serialize?: (value: any) => string\n  deserialize?: (value: string) => any\n  timeout?: number\n  def?: any\n}\n\nexport interface ConfigStore<State, Err = Error>\n  extends SessionStorageConfig,\n    BaseConfigStore<State, Err> {}\n\nexport interface ConfigSourceTarget<State, Err = Error>\n  extends SessionStorageConfig,\n    BaseConfigSourceTarget<State, Err> {}\n\nexport interface Persist {\n  <State, Err = Error>(config: ConfigSourceTarget<State, Err>): Subscription\n  <State, Err = Error>(config: ConfigStore<State, Err>): Subscription\n}\n\n/**\n * Function, checking if `sessionStorage` exists\n */\nfunction supports() {\n  try {\n    return typeof sessionStorage !== 'undefined'\n  } catch (error) {\n    // accessing `sessionStorage` could throw an exception only in one case -\n    // when `sessionStorage` IS supported, but blocked by security policies\n    return true\n  }\n}\n\n/**\n * Creates `sessionStorage` adapter\n */\nsession.factory = true as const\nexport function session(config?: SessionStorageConfig): StorageAdapter {\n  return supports()\n    ? storage({\n        storage: () => sessionStorage,\n        ...config,\n      })\n    : nil({ keyArea: 'session' })\n}\n\n/**\n * Creates custom partially applied `persist`\n * with predefined `sessionStorage` adapter\n */\nexport function createPersist(defaults?: ConfigPersist): Persist {\n  return (config) =>\n    base({\n      adapter: session,\n      ...defaults,\n      ...config,\n    })\n}\n\n/**\n * Default partially applied `persist`\n */\nexport const persist = createPersist()\n"],"names":["session","config","sessionStorage","error","supports","storage","nil","keyArea","createPersist","defaults","base","adapter","factory","persist"],"mappings":"+HA+DO,SAASA,EAAQC,GACtB,OAfF,WACE,IACE,MAAiC,oBAAnBC,cACf,CAAC,MAAOC,GAGP,OAAO,CACT,CACF,CAOSC,GACHC,EAAQ,CACNA,QAASA,IAAMH,kBACZD,IAELK,EAAI,CAAEC,QAAS,WACrB,CAMO,SAASC,EAAcC,GAC5B,OAAQR,GACNS,EAAK,CACHC,QAASX,KACNS,KACAR,GAET,CArBAD,EAAQY,SAAU,EA0BLC,IAAAA,EAAUL"}
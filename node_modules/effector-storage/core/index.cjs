"use strict";var e=require("effector"),r=new Map,t=e=>([r],t)=>e(t,r),a=e.createEvent();a.watch((e=>console.error(e.error))),exports.persist=function(o){var{adapter:i,store:s,source:c=s,target:n=s,clock:f=c,done:l,fail:d=a,finally:u,pickup:p,context:k,key:v,keyPrefix:g="",contract:y}=o;if(!i)throw Error("Adapter is not defined");if(!c)throw Error("Store or source is not defined");if(!n)throw Error("Target is not defined");if(!v&&c.shortName===c.id)throw Error("Key or name is not defined");if(c===n&&!e.is.store(c))throw Error("Source must be different from target");void 0===o.def&&e.is.store(c)&&(o.def=c.defaultState);var m="factory"in i?i(o):i,h=v||c.shortName,w=function(t,a){var o=r.get(t);void 0===o&&(o=new Map,r.set(t,o));var i=o.get(a);return void 0!==i||(i=e.createStore(null,{serialize:"ignore"}),o.set(a,i)),i}(m.keyArea||m,g+h),E=e.createNode(),x=()=>e.clearNode(E),P=e=>({status:r="fail",params:t,result:a,error:o})=>"done"===r?{status:r,key:h,keyPrefix:g,operation:e,value:"get"===e?a:t}:{status:r,key:h,keyPrefix:g,operation:e,value:"function"==typeof t?void 0:t,error:o};return e.withRegion(E,(()=>{var r=e.createStore([],{serialize:"ignore"}),a=m(g+h,(e=>{x(e)})),o=e.attach({source:r,effect:t(a.get)}),i=e.attach({source:r,effect:t(a.set)}),s=e.createEffect((e=>r=>!e||void 0===r||("isData"in e?e.isData(r):e(r))?r:(()=>{throw"getErrorMessages"in e?e.getErrorMessages(r):void 0})())(y)),v=e.createEvent(),E=e.createEvent(),x=o;r.updates.watch((()=>{x=e.scopeBind(o,{safe:!0})})),e.sample({clock:f,source:c,target:E}),e.sample({clock:E,source:w,filter:(e,r)=>r!==e,fn:(e,r)=>r,target:i}),e.sample({clock:[o.doneData,i],filter:e=>void 0!==e,target:w}),e.sample({clock:[o.doneData,w],target:s}),e.sample({clock:s.doneData,filter:e=>void 0!==e,target:n}),e.sample({clock:[o.finally.map(P("get")),i.finally.map(P("set")),s.fail.map(P("validate"))],target:v}),u&&e.sample({clock:v,target:u}),l&&e.sample({clock:v,filter:({status:e})=>"done"===e,fn:({key:e,keyPrefix:r,operation:t,value:a})=>({key:e,keyPrefix:r,operation:t,value:a}),target:l}),e.sample({clock:v,filter:({status:e})=>"fail"===e,fn:({key:e,keyPrefix:r,operation:t,error:a,value:o})=>({key:e,keyPrefix:r,operation:t,error:a,value:o}),target:d}),k&&r.on(k,(([e],r)=>[void 0===r?e:r])),p?(e.sample({clock:p,fn:()=>{},target:o}),r.on(p,(([e],r)=>[void 0===r?e:r]))):o()})),x.unsubscribe=x};
//# sourceMappingURL=index.cjs.map

function e(e){e===void 0&&(e={});var r=g((e=>{var r=e.replace;return{params:e.params||{},query:e.query||{},replace:r!==void 0&&r}}),{name:"navigateFx",sid:"-16itqs"}),a=b({and:{effect:r,mapParams:e=>({params:e||{},query:{}})},or:{name:"openFx",sid:"-34ax4v"}}),o=k(!1,{name:"$isOpened",sid:"-mkdat5"}),t=k({},{name:"$params",sid:"-dji428"}),n=k({},{name:"$query",sid:"g8ahyi"}),i=O({name:"opened",sid:"1k4p4d"}),d=O({name:"updated",sid:"2eisw8"}),s=O({name:"closed",sid:"yx116h"});return o.on(i,(()=>!0)).on(s,(()=>!1)),t.on(i,((e,r)=>r.params)).on(d,((e,r)=>r.params)),n.on(i,((e,r)=>r.query)).on(d,((e,r)=>r.query)),q({and:[{source:r.doneData,match:o.map((e=>e?"updated":"opened")),cases:{opened:i,updated:d}}],or:{sid:"2pgafx"}}),{$isOpened:o,$params:t,$query:n,opened:i,updated:d,closed:s,navigate:r,open:a,kind:F.ROUTE,settings:{derived:Boolean(e.filter)}}}function r(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((r=>Object.getOwnPropertyDescriptor(e,r).enumerable))),a.push.apply(a,o)}return a}function a(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?r(Object(o),!0).forEach((r=>{var a,t,n;a=e,n=o[r],(t=(e=>{var r=(e=>{if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)})(e);return"symbol"==typeof r?r:String(r)})(t=r))in a?Object.defineProperty(a,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[t]=n})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function o(e,r){(r==null||r>e.length)&&(r=e.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=e[a];return o}function t(e,r){var it=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(it)return(it=it.call(e)).next.bind(it);if(Array.isArray(e)||(it=((e,r)=>{if(e){if(typeof e=="string")return o(e,r);var a={}.toString.call(e).slice(8,-1);return a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set"?Array.from(e):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,r):void 0}})(e))||r&&e&&typeof e.length=="number"){it&&(e=it);var a=0;return()=>a>=e.length?{done:!0}:{done:!1,value:e[a++]}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var a in e)if(""+e[a]!=""+r[a])return!1;return!0}function i(){return{$query:k({},{and:{updateFilter:(e,r)=>!n(r,e)},name:"$query",sid:"-6fm59b"}),back:O({name:"back",sid:"m7e58l"}),forward:O({name:"forward",sid:"-4wdrfl"})}}function d(e){var r,a=e.params,o=e.query,t=e.serialize,n=x(e.pathCreator)(a),i=(r=t===null||t===void 0?void 0:t.write(o))!==null&&r!==void 0?r:new URLSearchParams(o);return n+(Object.keys(o).length?"?"+i:"")}function s(e){var r=e.actualPath,a=S(e.pathCreator.replace("://","\\://"))(U(r));return a?{matches:!0,params:a.params}:{matches:!1}}function u(e){return typeof e=="object"&&e!==null&&"kind"in e&&e.kind===F.ROUTE}function c(e){return u(e)}function l(e){if(!e)throw new Error("[Atomic-Router] No history provided")}function p(e){return e.map((e=>!e))}function m(e){var r=e.base,o=e.routes,u=e.notFoundRoute,l=e.hydrate,m=e.serialize,f=e.controls,v=f===void 0?w({sid:"-eby7",fn:()=>i(),name:"controls",method:"createRouterControls"}):f,y=k(l!==null&&l!==void 0&&l,{and:{serialize:"ignore"},name:"$hydrateMode",sid:"-i2numw"}),h=((e,r)=>{r===void 0&&(r="");for(var o,n=[],i=()=>{var e,r=o.value;Array.isArray(r.route)?(e=n).push.apply(e,r.route.map((e=>a(a({},r),{},{route:e})))):n.push(r)},d=t(e);!(o=d()).done;)i();n=n.map((e=>a(a({},e),{},{path:""+r+e.path})));for(var s,u=[],c=[],l=t(n);!(s=l()).done;){var p=s.value;p.route.settings.derived?u.push(p):c.push(p)}if(u.length)for(var m,f=t(u);!(m=f()).done;)console.error("[Atomic-Router]: createHistoryRouter: "+m.value.path+" uses derived route. This won't work");return c})(o,r),g=O({name:"setHistory",sid:"wo9d0s"}),q=O({name:"navigateFromRouteTriggered",sid:"9zf2q7"}),z=O({name:"historyUpdated",sid:"-2drux"}),P=O({name:"recalculateTriggered",sid:"dwpshq"}),x=O({name:"recalculated",sid:"cnxs21"}),S=O({name:"routesMatched",sid:"-oym918"}),F=O({name:"routesMismatched",sid:"wtlio3"}),U=O({name:"routeNotFound",sid:"-co9rfg"}),I=O({name:"initialized",sid:"uzcs7d"}),C=k("",{name:"$path",sid:"w0v7zo"}),H=k({},{and:{name:"historyRouter.$query",updateFilter:(e,r)=>!n(e,r)},name:"$query",sid:"34mtvb"}),Q=k([],{and:{serialize:"ignore"},name:"$activeRoutes",sid:"-q9xrap"}),L=k(null,{and:{serialize:"ignore"},name:"$history",sid:"jk9nd5"}),M=k(!1,{name:"$isFirstCheckPassed",sid:"y4c34b"}),N=k(!1,{name:"$isRouteNavigateInProgress",sid:"-6c2ssl"}),B=b({and:{source:L,effect:(e,r)=>E(a({history:e},r))},or:{name:"pushFx",sid:"gzjrp0"}}),_=b({and:{source:L,effect:e=>{var r=z;try{r=$(z)}catch(e){}return e.listen((()=>{r()})),!0}},or:{name:"subscribeHistoryFx",sid:"5wp0bd"}}),G=j({and:[{clock:l?[z]:[z,_.done],source:L,filter:Boolean,fn:e=>{var r;return{path:e.location.pathname,query:(r=m===null||m===void 0?void 0:m.read(e.location.search))!==null&&r!==void 0?r:Object.fromEntries(new URLSearchParams(e.location.search))}}}],or:{name:"historyUpdatedParsed",sid:"fmwavu"}}),J=j({and:[{clock:G,source:{path:C,query:H},filter:(e,r)=>r.path!==e.path||!n(r.query,e.query),fn:(e,r)=>r}],or:{name:"historyUpdateTriggered",sid:"-qpa0p5"}});L.on(g,((e,r)=>r)),j({and:[{clock:L,target:_}],or:{sid:"rwilmr"}}),j({and:[{clock:J,source:L,filter:Boolean,fn:e=>{var r,a=e===null||e===void 0?void 0:e.location.hash;return{path:e===null||e===void 0?void 0:e.location.pathname,query:(r=m===null||m===void 0?void 0:m.read(e===null||e===void 0?void 0:e.location.search))!==null&&r!==void 0?r:Object.fromEntries(new URLSearchParams(e===null||e===void 0?void 0:e.location.search)),hash:a}},target:P}],or:{sid:"rz9klk"}});for(var K,V=t(h);!(K=V()).done;){var W=K.value,X=S.filterMap(D(W)),Y=F.filterMap(D(W)),Z={initialized:j({and:[{clock:_.done,filter:R({and:[W.route.$isOpened,y,(e,r)=>e&&!r],or:{name:"filter",sid:"gu94on"}})}],or:{name:"initialized",sid:"-gxdv2m"}}),opened:j({and:[{clock:X,filter:p(W.route.$isOpened)}],or:{name:"opened",sid:"rd6yjz"}}),updated:j({and:[{clock:X,filter:W.route.$isOpened}],or:{name:"updated",sid:"-owo90k"}}),closed:j({and:[{clock:Y,filter:W.route.$isOpened}],or:{name:"closed",sid:"ic5bp1"}})};j({and:[{clock:Z.initialized,source:{params:W.route.$params,query:W.route.$query},target:W.route.opened}],or:{sid:"-ue11fh"}}),j({and:[{clock:Z.updated,source:[W.route.$params,W.route.$query],filter:(e,r)=>{var a=e[1];return!n(e[0],r.params)||!n(a,r.query)},fn:(e,r)=>r,target:W.route.updated}],or:{sid:"-twzf1a"}}),j({and:[{clock:Z.opened,filter:p(N),target:W.route.opened}],or:{sid:"-tfe01q"}}),j({and:[{clock:Z.closed,target:W.route.closed}],or:{sid:"-taznau"}})}for(var ee,re=()=>{var e=ee.value;j({and:[{clock:e.route.navigate.doneData,fn:r=>{var a=r.replace;return{route:e,params:r.params,query:r.query,replace:a!==null&&a!==void 0&&a}},target:q}],or:{sid:"-suhti0"}})},ae=t(h);!(ee=ae()).done;)re();N.on(q,(()=>!0)),j({and:[{clock:q,fn:e=>{var r=e.params,a=e.query,o=e.replace;return{path:d({pathCreator:e.route.path,params:r,query:a,serialize:m}),params:r,query:a,method:o?"replace":"push"}},target:B}],or:{sid:"-rzpcbi"}}),N.reset([S,F]),j({and:[{clock:P,fn:e=>{for(var r,a=e.path,o=e.query,n=e.hash,i=[],d=[],u=t(h);!(r=u()).done;){var c=r.value,l=c.path.includes("#")?""+a+n:""+a,p=s({pathCreator:c.path,actualPath:l});(p.matches?i:d).push({routeObj:c,params:p.params,query:o})}return d.forEach(((e,r)=>{i.some((r=>r.routeObj.route===e.routeObj.route))&&d.splice(r,1)})),{matching:i,mismatching:d.filter(Boolean),path:a,query:o}},target:x}],or:{sid:"-qzex5o"}}),C.on(J,((e,r)=>r.path)),H.on(J,((e,r)=>r.query));var oe=x.map((e=>e.matching));return j({and:[{clock:oe,filter:e=>e.length>0,target:S}],or:{sid:"-eosjhz"}}),j({and:[{clock:x.map((e=>e.mismatching)),filter:e=>e.length>0,target:F}],or:{sid:"-e9y3h8"}}),Q.on(x,((e,r)=>r.matching.map((e=>e.routeObj.route)))),j({and:[{clock:oe,filter:e=>e.length===0,target:U}],or:{sid:"-dscoho"}}),w({sid:"-dp1wu2",fn:()=>c(u),name:"none",method:"isRouteInternal"})&&(j({and:[{clock:U,source:H,filter:u.$isOpened,fn:e=>({query:e,params:{}}),target:u.updated}],or:{sid:"-doi4af"}}),j({and:[{clock:U,source:{query:H,isOpened:u.$isOpened},filter:e=>!e.isOpened,fn:e=>({query:e.query,params:{}}),target:u.opened}],or:{sid:"-d8k32y"}}),j({and:[{clock:oe,source:u.$isOpened,filter:(e,r)=>e&&r.length>0,target:u.closed}],or:{sid:"-csm1vh"}})),j({and:[{clock:v.back,source:L,target:A}],or:{sid:"-cc484d"}}),j({and:[{clock:v.forward,source:L,target:T}],or:{sid:"-bx9s3m"}}),j({and:[{clock:H,source:{controlsQuery:v.$query,localQuery:H},filter:e=>!n(e.controlsQuery,e.localQuery),fn:e=>e.localQuery,target:v.$query}],or:{sid:"-btf7y3"}}),j({and:[{clock:v.$query,source:{path:C,localQuery:H,isNavigateInProgress:N,realHistory:L},filter:(e,r)=>{var a,o,t,i=e.localQuery,d=e.isNavigateInProgress,s=e.realHistory,u=(a=m===null||m===void 0?void 0:m.read((o=s===null||s===void 0?void 0:s.location.search)!==null&&o!==void 0?o:""))!==null&&a!==void 0?a:Object.fromEntries(new URLSearchParams((t=s===null||s===void 0?void 0:s.location.search)!==null&&t!==void 0?t:""));return d||!n(r,u)||!n(i,r)},fn:(e,r)=>{var a,o=e.path,t=(a=m===null||m===void 0?void 0:m.write(r))!==null&&a!==void 0?a:new URLSearchParams(r);return{path:o+(t?"?"+t:""),params:{},query:r,method:"push"}},target:B}],or:{sid:"-bdh6qm"}}),j({and:[{clock:x,source:{activeRoutes:Q,path:C,query:H},filter:M.map((e=>!e)),target:I}],or:{sid:"-y1vb"}}),M.on(I,(()=>!0)).reset(L),{$path:C,$activeRoutes:Q,$history:L,setHistory:g,$query:H,back:v.back,forward:v.forward,push:B,routes:h,initialized:I,routeNotFound:U}}function f(e){var r=e.clock?j({and:[{clock:e.clock}],or:{name:"clock",sid:"-f15r5p"}}):O({name:"clock",sid:"-f0lykc"}),a=v(e.params||{}),o=v(e.query||{}),t=v(e.replace||!1);return j({and:[{clock:r,source:{params:a,query:o,replace:t},fn:(e,r)=>{var a=e.params,o=e.query,t=e.replace;return{params:typeof a=="function"?a(r):a,query:typeof o=="function"?o(r):o,replace:typeof t=="function"?t(r):t}},target:e.route.navigate}],or:{sid:"a0n4fl"}}),r}function v(e){return z.store(e,{sid:"akfpym"})?e:k(e,{sid:"-rk12b7"})}function y(r){var a=(r=>{var a={};if(w({sid:"-oimir7",fn:()=>c(r),name:"none",method:"isRouteInternal"}))return Object.assign(a,{route:r,chainedRoute:w({sid:"nxhp9m",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:O({name:"beforeOpen",sid:"-mzhjfk"}),openOn:P([r.opened,r.closed],{name:"openOn",sid:"-84w4rh"}),cancelOn:P([],{name:"cancelOn",sid:"-l2tb0w"})}),a;var o=r;if(Object.assign(a,{route:o.route,chainedRoute:o.chainedRoute||w({sid:"-wf80u2",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:z.unit(o.beforeOpen)?o.beforeOpen:b({and:o.beforeOpen,or:{name:"beforeOpen",sid:"-u0vw04"}})}),z.effect(a.beforeOpen,{sid:"-nlmv5j"}))return Object.assign(a,{openOn:o.openOn||a.beforeOpen.doneData,cancelOn:o.cancelOn||a.beforeOpen.failData}),a;var t=r;return Object.assign(a,{openOn:j({and:[{clock:t.openOn}],or:{name:"openOn",sid:"o26601"}}),cancelOn:j({and:[{clock:t.cancelOn||O({name:"clock",sid:"-x23z00"})}],or:{name:"cancelOn",sid:"l2720p"}})}),a})(r),o=a.route,t=a.chainedRoute,n=a.beforeOpen,i=a.openOn,d=a.cancelOn,s=k({},{name:"$params",sid:"-fpgvka"}),u=k({},{name:"$query",sid:"y4h4ag"}),l=R({and:[R({and:[[o.$params,o.$query]],or:{name:"and",sid:"120e5z"}}),R({and:[[s,u]],or:{name:"and",sid:"12k6rc"}}),(e,r)=>e[0]===r[0]&&e[1]===r[1]],or:{name:"$hasSameParams",sid:"uvxnko"}}),p=j({and:[{clock:[o.opened,o.updated]}],or:{name:"routeTriggered",sid:"-o4rktf"}});j({and:[{clock:p,target:n}],or:{sid:"-qinkky"}}),s.on(p,((e,r)=>r.params)),u.on(p,((e,r)=>r.query)),j({and:[{clock:i,source:{params:s,query:u},filter:l,target:t.navigate}],or:{sid:"-q25qs4"}});var m=P([o.closed,d],{name:"aborted",sid:"e9ezkr"});return s.reset(m),u.reset(m),j({and:[{clock:m,target:t.closed}],or:{sid:"-piwy0h"}}),t}function h(e){var r,o,n,i=(r=(o=e.route)===null||o===void 0?void 0:o.$isOpened)!==null&&r!==void 0?r:k(!0,{name:"$isOpened",sid:"-1sf5w3"}),d=R({and:[e.source],or:{name:"$source",sid:"-4puqls"}}),s=(n=e.clock)!==null&&n!==void 0?n:d,u="cleanup"in e?typeof e.cleanup=="boolean"?I[e.cleanup?"all":"none"]:a(a({},I.default),e.cleanup):I.default,c=j({and:[{clock:e.controls.$query,filter:i}],or:{name:"queryUpdatedFromHistory",sid:"7nbv4h"}});j({and:[{clock:s,source:R({and:[[d,e.controls.$query]],or:{name:"source",sid:"-4nk0xe"}}),filter:i,fn:e=>{var r=e[0],o=e[1],n={};if(u.irrelevant)for(var i,d=t(u.preserve);!(i=d()).done;){var s=i.value;s in o&&(n[s]=o[s])}else n=a({},o);for(var c in r)n[c]=r[c];if(u.empty)for(var l in r)u.preserve.includes(l)||n[l]||delete n[l];return n},target:e.controls.$query}],or:{sid:"ftvpyq"}});var l=r=>{var a=e.source[r];a.on(c,((e,o)=>{var t;return(t=o[r])!==null&&t!==void 0?t:a.defaultState}))};for(var p in e.source)l(p)}import{createEffect as g,attach as b,createStore as k,createEvent as O,split as q,withFactory as w,scopeBind as $,sample as j,combine as R,is as z,merge as P}from'effector';import{compile as x,match as S}from'path-to-regexp';var F={ROUTE:Symbol()},U=e=>{if(e.match(/^[a-z0-9]+\:\/\//i))return e;var r=new URL("http://_"+e);return[r.pathname,r.hash].join("")},E=g((e=>(l(e.history),e.history[e.method](e.path,{}),e)),{name:"historyPushFx",sid:"xw3ola"}),A=g((e=>(l(e),e.back(),e)),{name:"historyBackFx",sid:"-q0iw6t"}),T=g((e=>(l(e),e.forward(),e)),{name:"historyForwardFx",sid:"du9nya"}),D=e=>r=>{var a=r.find((r=>r.routeObj.route===e.route));if(a)return{params:a.params,query:a.query}},I={all:{irrelevant:!0,empty:!0,preserve:[]},default:{irrelevant:!1,empty:!0,preserve:[]},none:{irrelevant:!1,empty:!1,preserve:[]}};export{F as Kind,d as buildPath,y as chainRoute,m as createHistoryRouter,e as createRoute,i as createRouterControls,u as isRoute,s as matchPath,h as querySync,f as redirect};
//# sourceMappingURL=atomic-router.mjs.map

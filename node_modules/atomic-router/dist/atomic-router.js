function e(e){e===void 0&&(e={});var r=effector.createEffect((e=>{var r=e.replace;return{params:e.params||{},query:e.query||{},replace:r!==void 0&&r}}),{name:"navigateFx",sid:"-16itqs"}),a=effector.attach({and:{effect:r,mapParams:e=>({params:e||{},query:{}})},or:{name:"openFx",sid:"-34ax4v"}}),t=effector.createStore(!1,{name:"$isOpened",sid:"-mkdat5"}),o=effector.createStore({},{name:"$params",sid:"-dji428"}),n=effector.createStore({},{name:"$query",sid:"g8ahyi"}),i=effector.createEvent({name:"opened",sid:"1k4p4d"}),s=effector.createEvent({name:"updated",sid:"2eisw8"}),c=effector.createEvent({name:"closed",sid:"yx116h"});return t.on(i,(()=>!0)).on(c,(()=>!1)),o.on(i,((e,r)=>r.params)).on(s,((e,r)=>r.params)),n.on(i,((e,r)=>r.query)).on(s,((e,r)=>r.query)),effector.split({and:[{source:r.doneData,match:t.map((e=>e?"updated":"opened")),cases:{opened:i,updated:s}}],or:{sid:"2pgafx"}}),{$isOpened:t,$params:o,$query:n,opened:i,updated:s,closed:c,navigate:r,open:a,kind:v.ROUTE,settings:{derived:Boolean(e.filter)}}}function r(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((r=>Object.getOwnPropertyDescriptor(e,r).enumerable))),a.push.apply(a,t)}return a}function a(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((r=>{var a,o,n;a=e,n=t[r],(o=(e=>{var r=(e=>{if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)})(e);return"symbol"==typeof r?r:String(r)})(o=r))in a?Object.defineProperty(a,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[o]=n})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function t(e,r){(r==null||r>e.length)&&(r=e.length);for(var a=0,t=new Array(r);a<r;a++)t[a]=e[a];return t}function o(e,r){var it=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(it)return(it=it.call(e)).next.bind(it);if(Array.isArray(e)||(it=((e,r)=>{if(e){if(typeof e=="string")return t(e,r);var a={}.toString.call(e).slice(8,-1);return a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set"?Array.from(e):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}})(e))||r&&e&&typeof e.length=="number"){it&&(e=it);var a=0;return()=>a>=e.length?{done:!0}:{done:!1,value:e[a++]}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var a in e)if(""+e[a]!=""+r[a])return!1;return!0}function i(){return{$query:effector.createStore({},{and:{updateFilter:(e,r)=>!n(r,e)},name:"$query",sid:"-6fm59b"}),back:effector.createEvent({name:"back",sid:"m7e58l"}),forward:effector.createEvent({name:"forward",sid:"-4wdrfl"})}}function s(e){var r,a=e.params,t=e.query,o=e.serialize,n=f.compile(e.pathCreator)(a),i=(r=o===null||o===void 0?void 0:o.write(t))!==null&&r!==void 0?r:new URLSearchParams(t);return n+(Object.keys(t).length?"?"+i:"")}function c(e){var r=e.actualPath,a=f.match(e.pathCreator.replace("://","\\://"))(h(r));return a?{matches:!0,params:a.params}:{matches:!1}}function d(e){return typeof e=="object"&&e!==null&&"kind"in e&&e.kind===v.ROUTE}function l(e){return d(e)}function u(e){if(!e)throw new Error("[Atomic-Router] No history provided")}function p(e){return e.map((e=>!e))}function m(e){return effector.is.store(e,{sid:"akfpym"})?e:effector.createStore(e,{sid:"-rk12b7"})}var effector=require('effector'),f=require('path-to-regexp'),v={ROUTE:Symbol()},h=e=>{if(e.match(/^[a-z0-9]+\:\/\//i))return e;var r=new URL("http://_"+e);return[r.pathname,r.hash].join("")},y=effector.createEffect((e=>(u(e.history),e.history[e.method](e.path,{}),e)),{name:"historyPushFx",sid:"xw3ola"}),g=effector.createEffect((e=>(u(e),e.back(),e)),{name:"historyBackFx",sid:"-q0iw6t"}),b=effector.createEffect((e=>(u(e),e.forward(),e)),{name:"historyForwardFx",sid:"du9nya"}),k=e=>r=>{var a=r.find((r=>r.routeObj.route===e.route));if(a)return{params:a.params,query:a.query}},O={all:{irrelevant:!0,empty:!0,preserve:[]},default:{irrelevant:!1,empty:!0,preserve:[]},none:{irrelevant:!1,empty:!1,preserve:[]}};exports.Kind=v,exports.buildPath=s,exports.chainRoute=r=>{var a=(r=>{var a={};if(effector.withFactory({sid:"-oimir7",fn:()=>l(r),name:"none",method:"isRouteInternal"}))return Object.assign(a,{route:r,chainedRoute:effector.withFactory({sid:"nxhp9m",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.createEvent({name:"beforeOpen",sid:"-mzhjfk"}),openOn:effector.merge([r.opened,r.closed],{name:"openOn",sid:"-84w4rh"}),cancelOn:effector.merge([],{name:"cancelOn",sid:"-l2tb0w"})}),a;var t=r;if(Object.assign(a,{route:t.route,chainedRoute:t.chainedRoute||effector.withFactory({sid:"-wf80u2",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.is.unit(t.beforeOpen)?t.beforeOpen:effector.attach({and:t.beforeOpen,or:{name:"beforeOpen",sid:"-u0vw04"}})}),effector.is.effect(a.beforeOpen,{sid:"-nlmv5j"}))return Object.assign(a,{openOn:t.openOn||a.beforeOpen.doneData,cancelOn:t.cancelOn||a.beforeOpen.failData}),a;var o=r;return Object.assign(a,{openOn:effector.sample({and:[{clock:o.openOn}],or:{name:"openOn",sid:"o26601"}}),cancelOn:effector.sample({and:[{clock:o.cancelOn||effector.createEvent({name:"clock",sid:"-x23z00"})}],or:{name:"cancelOn",sid:"l2720p"}})}),a})(r),t=a.route,o=a.chainedRoute,n=a.beforeOpen,i=a.openOn,s=a.cancelOn,c=effector.createStore({},{name:"$params",sid:"-fpgvka"}),d=effector.createStore({},{name:"$query",sid:"y4h4ag"}),u=effector.combine({and:[effector.combine({and:[[t.$params,t.$query]],or:{name:"and",sid:"120e5z"}}),effector.combine({and:[[c,d]],or:{name:"and",sid:"12k6rc"}}),(e,r)=>e[0]===r[0]&&e[1]===r[1]],or:{name:"$hasSameParams",sid:"uvxnko"}}),p=effector.sample({and:[{clock:[t.opened,t.updated]}],or:{name:"routeTriggered",sid:"-o4rktf"}});effector.sample({and:[{clock:p,target:n}],or:{sid:"-qinkky"}}),c.on(p,((e,r)=>r.params)),d.on(p,((e,r)=>r.query)),effector.sample({and:[{clock:i,source:{params:c,query:d},filter:u,target:o.navigate}],or:{sid:"-q25qs4"}});var m=effector.merge([t.closed,s],{name:"aborted",sid:"e9ezkr"});return c.reset(m),d.reset(m),effector.sample({and:[{clock:m,target:o.closed}],or:{sid:"-piwy0h"}}),o},exports.createHistoryRouter=e=>{var r=e.base,t=e.routes,d=e.notFoundRoute,u=e.hydrate,m=e.serialize,f=e.controls,v=f===void 0?effector.withFactory({sid:"-eby7",fn:()=>i(),name:"controls",method:"createRouterControls"}):f,h=effector.createStore(u!==null&&u!==void 0&&u,{and:{serialize:"ignore"},name:"$hydrateMode",sid:"-i2numw"}),O=((e,r)=>{r===void 0&&(r="");for(var t,n=[],i=()=>{var e,r=t.value;Array.isArray(r.route)?(e=n).push.apply(e,r.route.map((e=>a(a({},r),{},{route:e})))):n.push(r)},s=o(e);!(t=s()).done;)i();n=n.map((e=>a(a({},e),{},{path:""+r+e.path})));for(var c,d=[],l=[],u=o(n);!(c=u()).done;){var p=c.value;p.route.settings.derived?d.push(p):l.push(p)}if(d.length)for(var m,f=o(d);!(m=f()).done;)console.error("[Atomic-Router]: createHistoryRouter: "+m.value.path+" uses derived route. This won't work");return l})(t,r),q=effector.createEvent({name:"setHistory",sid:"wo9d0s"}),w=effector.createEvent({name:"navigateFromRouteTriggered",sid:"9zf2q7"}),$=effector.createEvent({name:"historyUpdated",sid:"-2drux"}),j=effector.createEvent({name:"recalculateTriggered",sid:"dwpshq"}),R=effector.createEvent({name:"recalculated",sid:"cnxs21"}),S=effector.createEvent({name:"routesMatched",sid:"-oym918"}),x=effector.createEvent({name:"routesMismatched",sid:"wtlio3"}),E=effector.createEvent({name:"routeNotFound",sid:"-co9rfg"}),P=effector.createEvent({name:"initialized",sid:"uzcs7d"}),z=effector.createStore("",{name:"$path",sid:"w0v7zo"}),F=effector.createStore({},{and:{name:"historyRouter.$query",updateFilter:(e,r)=>!n(e,r)},name:"$query",sid:"34mtvb"}),U=effector.createStore([],{and:{serialize:"ignore"},name:"$activeRoutes",sid:"-q9xrap"}),A=effector.createStore(null,{and:{serialize:"ignore"},name:"$history",sid:"jk9nd5"}),T=effector.createStore(!1,{name:"$isFirstCheckPassed",sid:"y4c34b"}),C=effector.createStore(!1,{name:"$isRouteNavigateInProgress",sid:"-6c2ssl"}),D=effector.attach({and:{source:A,effect:(e,r)=>y(a({history:e},r))},or:{name:"pushFx",sid:"gzjrp0"}}),H=effector.attach({and:{source:A,effect:e=>{var r=$;try{r=effector.scopeBind($)}catch(e){}return e.listen((()=>{r()})),!0}},or:{name:"subscribeHistoryFx",sid:"5wp0bd"}}),I=effector.sample({and:[{clock:u?[$]:[$,H.done],source:A,filter:Boolean,fn:e=>{var r;return{path:e.location.pathname,query:(r=m===null||m===void 0?void 0:m.read(e.location.search))!==null&&r!==void 0?r:Object.fromEntries(new URLSearchParams(e.location.search))}}}],or:{name:"historyUpdatedParsed",sid:"fmwavu"}}),Q=effector.sample({and:[{clock:I,source:{path:z,query:F},filter:(e,r)=>r.path!==e.path||!n(r.query,e.query),fn:(e,r)=>r}],or:{name:"historyUpdateTriggered",sid:"-qpa0p5"}});A.on(q,((e,r)=>r)),effector.sample({and:[{clock:A,target:H}],or:{sid:"rwilmr"}}),effector.sample({and:[{clock:Q,source:A,filter:Boolean,fn:e=>{var r,a=e===null||e===void 0?void 0:e.location.hash;return{path:e===null||e===void 0?void 0:e.location.pathname,query:(r=m===null||m===void 0?void 0:m.read(e===null||e===void 0?void 0:e.location.search))!==null&&r!==void 0?r:Object.fromEntries(new URLSearchParams(e===null||e===void 0?void 0:e.location.search)),hash:a}},target:j}],or:{sid:"rz9klk"}});for(var B,L=o(O);!(B=L()).done;){var M=B.value,N=S.filterMap(k(M)),K=x.filterMap(k(M)),_={initialized:effector.sample({and:[{clock:H.done,filter:effector.combine({and:[M.route.$isOpened,h,(e,r)=>e&&!r],or:{name:"filter",sid:"gu94on"}})}],or:{name:"initialized",sid:"-gxdv2m"}}),opened:effector.sample({and:[{clock:N,filter:p(M.route.$isOpened)}],or:{name:"opened",sid:"rd6yjz"}}),updated:effector.sample({and:[{clock:N,filter:M.route.$isOpened}],or:{name:"updated",sid:"-owo90k"}}),closed:effector.sample({and:[{clock:K,filter:M.route.$isOpened}],or:{name:"closed",sid:"ic5bp1"}})};effector.sample({and:[{clock:_.initialized,source:{params:M.route.$params,query:M.route.$query},target:M.route.opened}],or:{sid:"-ue11fh"}}),effector.sample({and:[{clock:_.updated,source:[M.route.$params,M.route.$query],filter:(e,r)=>{var a=e[1];return!n(e[0],r.params)||!n(a,r.query)},fn:(e,r)=>r,target:M.route.updated}],or:{sid:"-twzf1a"}}),effector.sample({and:[{clock:_.opened,filter:p(C),target:M.route.opened}],or:{sid:"-tfe01q"}}),effector.sample({and:[{clock:_.closed,target:M.route.closed}],or:{sid:"-taznau"}})}for(var G,J=()=>{var e=G.value;effector.sample({and:[{clock:e.route.navigate.doneData,fn:r=>{var a=r.replace;return{route:e,params:r.params,query:r.query,replace:a!==null&&a!==void 0&&a}},target:w}],or:{sid:"-suhti0"}})},V=o(O);!(G=V()).done;)J();C.on(w,(()=>!0)),effector.sample({and:[{clock:w,fn:e=>{var r=e.params,a=e.query,t=e.replace;return{path:s({pathCreator:e.route.path,params:r,query:a,serialize:m}),params:r,query:a,method:t?"replace":"push"}},target:D}],or:{sid:"-rzpcbi"}}),C.reset([S,x]),effector.sample({and:[{clock:j,fn:e=>{for(var r,a=e.path,t=e.query,n=e.hash,i=[],s=[],d=o(O);!(r=d()).done;){var l=r.value,u=l.path.includes("#")?""+a+n:""+a,p=c({pathCreator:l.path,actualPath:u});(p.matches?i:s).push({routeObj:l,params:p.params,query:t})}return s.forEach(((e,r)=>{i.some((r=>r.routeObj.route===e.routeObj.route))&&s.splice(r,1)})),{matching:i,mismatching:s.filter(Boolean),path:a,query:t}},target:R}],or:{sid:"-qzex5o"}}),z.on(Q,((e,r)=>r.path)),F.on(Q,((e,r)=>r.query));var W=R.map((e=>e.matching));return effector.sample({and:[{clock:W,filter:e=>e.length>0,target:S}],or:{sid:"-eosjhz"}}),effector.sample({and:[{clock:R.map((e=>e.mismatching)),filter:e=>e.length>0,target:x}],or:{sid:"-e9y3h8"}}),U.on(R,((e,r)=>r.matching.map((e=>e.routeObj.route)))),effector.sample({and:[{clock:W,filter:e=>e.length===0,target:E}],or:{sid:"-dscoho"}}),effector.withFactory({sid:"-dp1wu2",fn:()=>l(d),name:"none",method:"isRouteInternal"})&&(effector.sample({and:[{clock:E,source:F,filter:d.$isOpened,fn:e=>({query:e,params:{}}),target:d.updated}],or:{sid:"-doi4af"}}),effector.sample({and:[{clock:E,source:{query:F,isOpened:d.$isOpened},filter:e=>!e.isOpened,fn:e=>({query:e.query,params:{}}),target:d.opened}],or:{sid:"-d8k32y"}}),effector.sample({and:[{clock:W,source:d.$isOpened,filter:(e,r)=>e&&r.length>0,target:d.closed}],or:{sid:"-csm1vh"}})),effector.sample({and:[{clock:v.back,source:A,target:g}],or:{sid:"-cc484d"}}),effector.sample({and:[{clock:v.forward,source:A,target:b}],or:{sid:"-bx9s3m"}}),effector.sample({and:[{clock:F,source:{controlsQuery:v.$query,localQuery:F},filter:e=>!n(e.controlsQuery,e.localQuery),fn:e=>e.localQuery,target:v.$query}],or:{sid:"-btf7y3"}}),effector.sample({and:[{clock:v.$query,source:{path:z,localQuery:F,isNavigateInProgress:C,realHistory:A},filter:(e,r)=>{var a,t,o,i=e.localQuery,s=e.isNavigateInProgress,c=e.realHistory,d=(a=m===null||m===void 0?void 0:m.read((t=c===null||c===void 0?void 0:c.location.search)!==null&&t!==void 0?t:""))!==null&&a!==void 0?a:Object.fromEntries(new URLSearchParams((o=c===null||c===void 0?void 0:c.location.search)!==null&&o!==void 0?o:""));return s||!n(r,d)||!n(i,r)},fn:(e,r)=>{var a,t=e.path,o=(a=m===null||m===void 0?void 0:m.write(r))!==null&&a!==void 0?a:new URLSearchParams(r);return{path:t+(o?"?"+o:""),params:{},query:r,method:"push"}},target:D}],or:{sid:"-bdh6qm"}}),effector.sample({and:[{clock:R,source:{activeRoutes:U,path:z,query:F},filter:T.map((e=>!e)),target:P}],or:{sid:"-y1vb"}}),T.on(P,(()=>!0)).reset(A),{$path:z,$activeRoutes:U,$history:A,setHistory:q,$query:F,back:v.back,forward:v.forward,push:D,routes:O,initialized:P,routeNotFound:E}},exports.createRoute=e,exports.createRouterControls=i,exports.isRoute=d,exports.matchPath=c,exports.querySync=e=>{var r,t,n,i=(r=(t=e.route)===null||t===void 0?void 0:t.$isOpened)!==null&&r!==void 0?r:effector.createStore(!0,{name:"$isOpened",sid:"-1sf5w3"}),s=effector.combine({and:[e.source],or:{name:"$source",sid:"-4puqls"}}),c=(n=e.clock)!==null&&n!==void 0?n:s,d="cleanup"in e?typeof e.cleanup=="boolean"?O[e.cleanup?"all":"none"]:a(a({},O.default),e.cleanup):O.default,l=effector.sample({and:[{clock:e.controls.$query,filter:i}],or:{name:"queryUpdatedFromHistory",sid:"7nbv4h"}});effector.sample({and:[{clock:c,source:effector.combine({and:[[s,e.controls.$query]],or:{name:"source",sid:"-4nk0xe"}}),filter:i,fn:e=>{var r=e[0],t=e[1],n={};if(d.irrelevant)for(var i,s=o(d.preserve);!(i=s()).done;){var c=i.value;c in t&&(n[c]=t[c])}else n=a({},t);for(var l in r)n[l]=r[l];if(d.empty)for(var u in r)d.preserve.includes(u)||n[u]||delete n[u];return n},target:e.controls.$query}],or:{sid:"ftvpyq"}});var u=r=>{var a=e.source[r];a.on(l,((e,t)=>{var o;return(o=t[r])!==null&&o!==void 0?o:a.defaultState}))};for(var p in e.source)u(p)},exports.redirect=e=>{var r=e.clock?effector.sample({and:[{clock:e.clock}],or:{name:"clock",sid:"-f15r5p"}}):effector.createEvent({name:"clock",sid:"-f0lykc"}),a=m(e.params||{}),t=m(e.query||{}),o=m(e.replace||!1);return effector.sample({and:[{clock:r,source:{params:a,query:t,replace:o},fn:(e,r)=>{var a=e.params,t=e.query,o=e.replace;return{params:typeof a=="function"?a(r):a,query:typeof t=="function"?t(r):t,replace:typeof o=="function"?o(r):o}},target:e.route.navigate}],or:{sid:"a0n4fl"}}),r};
//# sourceMappingURL=atomic-router.js.map

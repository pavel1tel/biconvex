((e,r)=>{typeof exports=='object'&&typeof module!='undefined'?r(exports,require('effector')):typeof define=='function'&&define.amd?define(['exports','effector'],r):r((e=typeof globalThis!='undefined'?globalThis:e||self).atomicRouter={},e.effector)})(this,((e,effector)=>{function r(e){e===void 0&&(e={});var r=effector.createEffect((e=>{var r=e.replace;return{params:e.params||{},query:e.query||{},replace:r!==void 0&&r}}),{name:"navigateFx",sid:"-16itqs"}),t=effector.attach({and:{effect:r,mapParams:e=>({params:e||{},query:{}})},or:{name:"openFx",sid:"-34ax4v"}}),a=effector.createStore(!1,{name:"$isOpened",sid:"-mkdat5"}),n=effector.createStore({},{name:"$params",sid:"-dji428"}),o=effector.createStore({},{name:"$query",sid:"g8ahyi"}),i=effector.createEvent({name:"opened",sid:"1k4p4d"}),c=effector.createEvent({name:"updated",sid:"2eisw8"}),s=effector.createEvent({name:"closed",sid:"yx116h"});return a.on(i,(()=>!0)).on(s,(()=>!1)),n.on(i,((e,r)=>r.params)).on(c,((e,r)=>r.params)),o.on(i,((e,r)=>r.query)).on(c,((e,r)=>r.query)),effector.split({and:[{source:r.doneData,match:a.map((e=>e?"updated":"opened")),cases:{opened:i,updated:c}}],or:{sid:"2pgafx"}}),{$isOpened:a,$params:n,$query:o,opened:i,updated:c,closed:s,navigate:r,open:t,kind:w.ROUTE,settings:{derived:Boolean(e.filter)}}}function t(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((r=>Object.getOwnPropertyDescriptor(e,r).enumerable))),t.push.apply(t,a)}return t}function a(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?t(Object(a),!0).forEach((r=>{n(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function n(e,r,t){return(r=(e=>{var r=(e=>{if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)})(e);return"symbol"==typeof r?r:String(r)})(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}function i(e,r){var it=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(it)return(it=it.call(e)).next.bind(it);if(Array.isArray(e)||(it=((e,r)=>{if(e){if(typeof e=="string")return o(e,r);var t={}.toString.call(e).slice(8,-1);return t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set"?Array.from(e):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,r):void 0}})(e))||r&&e&&typeof e.length=="number"){it&&(e=it);var t=0;return()=>t>=e.length?{done:!0}:{done:!1,value:e[t++]}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var t in e)if(""+e[t]!=""+r[t])return!1;return!0}function s(){return{$query:effector.createStore({},{and:{updateFilter:(e,r)=>!c(r,e)},name:"$query",sid:"-6fm59b"}),back:effector.createEvent({name:"back",sid:"m7e58l"}),forward:effector.createEvent({name:"forward",sid:"-4wdrfl"})}}function d(e,r){r===void 0&&(r={});for(var t=(e=>{for(var r=[],t=0;t<e.length;){var a=e[t];if(a!=="*"&&a!=="+"&&a!=="?")if(a!=="\\")if(a!=="{")if(a!=="}")if(a!==":")if(a!=="(")r.push({type:"CHAR",index:t,value:e[t++]});else{var n=1,o="";if(e[c=t+1]==="?")throw new TypeError("Pattern cannot start with \"?\" at ".concat(c));for(;c<e.length;)if(e[c]!=="\\"){if(e[c]===")"){if(--n==0){c++;break}}else if(e[c]==="("&&(n++,e[c+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(c));o+=e[c++]}else o+=e[c++]+e[c++];if(n)throw new TypeError("Unbalanced pattern at ".concat(t));if(!o)throw new TypeError("Missing pattern at ".concat(t));r.push({type:"PATTERN",index:t,value:o}),t=c}else{for(var i="",c=t+1;c<e.length;){var s=e.charCodeAt(c);if(!(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||s===95))break;i+=e[c++]}if(!i)throw new TypeError("Missing parameter name at ".concat(t));r.push({type:"NAME",index:t,value:i}),t=c}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r})(e),a=r.prefixes,n=a===void 0?"./":a,o="[^".concat(l(r.delimiter||"/#?"),"]+?"),i=[],c=0,s=0,d="",u=e=>{if(s<t.length&&t[s].type===e)return t[s++].value},p=e=>{var r=u(e);if(r!==void 0)return r;var a=t[s],n=a.index;throw new TypeError("Unexpected ".concat(a.type," at ").concat(n,", expected ").concat(e))},f=()=>{for(var e,r="";e=u("CHAR")||u("ESCAPED_CHAR");)r+=e;return r};s<t.length;){var m=u("CHAR"),v=u("NAME"),h=u("PATTERN");if(v||h)n.indexOf(g=m||"")===-1&&(d+=g,g=""),d&&(i.push(d),d=""),i.push({name:v||c++,prefix:g,suffix:"",pattern:h||o,modifier:u("MODIFIER")||""});else{var y=m||u("ESCAPED_CHAR");if(y)d+=y;else if(d&&(i.push(d),d=""),u("OPEN")){var g=f(),b=u("NAME")||"",O=u("PATTERN")||"",w=f();p("CLOSE"),i.push({name:b||(O?c++:""),pattern:b&&!O?o:O,prefix:g,suffix:w,modifier:u("MODIFIER")||""})}else p("END")}}return i}function u(e,r){var t=[];return((e,r,t)=>{t===void 0&&(t={});var a=t.decode,n=a===void 0?e=>e:a;return t=>{var a=e.exec(t);if(!a)return!1;for(var o=a[0],i=a.index,c=Object.create(null),s=e=>{if(a[e]===void 0)return"continue";var t=r[e-1];c[t.name]=t.modifier==="*"||t.modifier==="+"?a[e].split(t.prefix+t.suffix).map((e=>n(e,t))):n(a[e],t)},d=1;d<a.length;d++)s(d);return{path:o,index:i,params:c}}})(f(e,t,r),t,r)}function l(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function p(e){return e&&e.sensitive?"":"i"}function f(e,r,t){return e instanceof RegExp?((e,r)=>{if(!r)return e;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,a=0,n=t.exec(e.source);n;)r.push({name:n[1]||a++,prefix:"",suffix:"",modifier:"",pattern:""}),n=t.exec(e.source);return e})(e,r):Array.isArray(e)?((e,r,t)=>{var a=e.map((e=>f(e,r,t).source));return new RegExp("(?:".concat(a.join("|"),")"),p(t))})(e,r,t):((e,r,t)=>((e,r,t)=>{t===void 0&&(t={});for(var a=t.strict,n=a!==void 0&&a,o=t.start,i=o===void 0||o,c=t.end,s=c===void 0||c,d=t.encode,u=d===void 0?e=>e:d,f=t.delimiter,m=f===void 0?"/#?":f,v=t.endsWith,h="[".concat(l(v===void 0?"":v),"]|$"),y="[".concat(l(m),"]"),g=i?"^":"",b=0,O=e;b<O.length;b++){var w=O[b];if(typeof w=="string")g+=l(u(w));else{var k=l(u(w.prefix)),E=l(u(w.suffix));if(w.pattern)if(r&&r.push(w),k||E)if(w.modifier==="+"||w.modifier==="*"){var q=w.modifier==="*"?"?":"";g+="(?:".concat(k,"((?:").concat(w.pattern,")(?:").concat(E).concat(k,"(?:").concat(w.pattern,"))*)").concat(E,")").concat(q)}else g+="(?:".concat(k,"(").concat(w.pattern,")").concat(E,")").concat(w.modifier);else g+=w.modifier==="+"||w.modifier==="*"?"((?:".concat(w.pattern,")").concat(w.modifier,")"):"(".concat(w.pattern,")").concat(w.modifier);else g+="(?:".concat(k).concat(E,")").concat(w.modifier)}}if(s)n||(g+="".concat(y,"?")),g+=t.endsWith?"(?=".concat(h,")"):"$";else{var x=e[e.length-1],R=typeof x=="string"?y.indexOf(x[x.length-1])>-1:x===void 0;n||(g+="(?:".concat(y,"(?=").concat(h,"))?")),R||(g+="(?=".concat(y,"|").concat(h,")"))}return new RegExp(g,p(t))})(d(e,t),r,t))(e,r,t)}function m(e){var r,t=e.params,a=e.query,n=e.serialize,o=((e,r)=>((e,r)=>{r===void 0&&(r={});var t=p(r),a=r.encode,n=a===void 0?e=>e:a,o=r.validate,i=o===void 0||o,c=e.map((e=>{if(typeof e=="object")return new RegExp("^(?:".concat(e.pattern,")$"),t)}));return r=>{for(var t="",a=0;a<e.length;a++){var o=e[a];if(typeof o!="string"){var s=r?r[o.name]:void 0,d=o.modifier==="?"||o.modifier==="*",u=o.modifier==="*"||o.modifier==="+";if(Array.isArray(s)){if(!u)throw new TypeError("Expected \"".concat(o.name,"\" to not repeat, but got an array"));if(s.length===0){if(d)continue;throw new TypeError("Expected \"".concat(o.name,"\" to not be empty"))}for(var l=0;l<s.length;l++){var p=n(s[l],o);if(i&&!c[a].test(p))throw new TypeError("Expected all \"".concat(o.name,"\" to match \"").concat(o.pattern,"\", but got \"").concat(p,"\""));t+=o.prefix+p+o.suffix}}else if(typeof s!="string"&&typeof s!="number"){if(!d){var f=u?"an array":"a string";throw new TypeError("Expected \"".concat(o.name,"\" to be ").concat(f))}}else{if(p=n(String(s),o),i&&!c[a].test(p))throw new TypeError("Expected \"".concat(o.name,"\" to match \"").concat(o.pattern,"\", but got \"").concat(p,"\""));t+=o.prefix+p+o.suffix}}else t+=o}return t}})(d(e,r),r))(e.pathCreator)(t),i=(r=n===null||n===void 0?void 0:n.write(a))!==null&&r!==void 0?r:new URLSearchParams(a);return o+(Object.keys(a).length?"?"+i:"")}function v(e){var r=e.actualPath,t=u((e=>e.replace("://","\\://"))(e.pathCreator))(k(r));return t?{matches:!0,params:t.params}:{matches:!1}}function h(e){return typeof e=="object"&&e!==null&&"kind"in e&&e.kind===w.ROUTE}function y(e){return h(e)}function g(e){if(!e)throw new Error("[Atomic-Router] No history provided")}function b(e){return e.map((e=>!e))}function O(e){return effector.is.store(e,{sid:"akfpym"})?e:effector.createStore(e,{sid:"-rk12b7"})}var w={ROUTE:Symbol()},k=e=>{if(e.match(/^[a-z0-9]+\:\/\//i))return e;var r=new URL("http://_"+e);return[r.pathname,r.hash].join("")},E=effector.createEffect((e=>(g(e.history),e.history[e.method](e.path,{}),e)),{name:"historyPushFx",sid:"xw3ola"}),q=effector.createEffect((e=>(g(e),e.back(),e)),{name:"historyBackFx",sid:"-q0iw6t"}),x=effector.createEffect((e=>(g(e),e.forward(),e)),{name:"historyForwardFx",sid:"du9nya"}),R=e=>r=>{var t=r.find((r=>r.routeObj.route===e.route));if(t)return{params:t.params,query:t.query}},$={all:{irrelevant:!0,empty:!0,preserve:[]},default:{irrelevant:!1,empty:!0,preserve:[]},none:{irrelevant:!1,empty:!1,preserve:[]}};e.Kind=w,e.buildPath=m,e.chainRoute=e=>{var t=(e=>{var t={};if(effector.withFactory({sid:"-oimir7",fn:()=>y(e),name:"none",method:"isRouteInternal"}))return Object.assign(t,{route:e,chainedRoute:effector.withFactory({sid:"nxhp9m",fn:()=>r(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.createEvent({name:"beforeOpen",sid:"-mzhjfk"}),openOn:effector.merge([e.opened,e.closed],{name:"openOn",sid:"-84w4rh"}),cancelOn:effector.merge([],{name:"cancelOn",sid:"-l2tb0w"})}),t;var a=e;if(Object.assign(t,{route:a.route,chainedRoute:a.chainedRoute||effector.withFactory({sid:"-wf80u2",fn:()=>r(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.is.unit(a.beforeOpen)?a.beforeOpen:effector.attach({and:a.beforeOpen,or:{name:"beforeOpen",sid:"-u0vw04"}})}),effector.is.effect(t.beforeOpen,{sid:"-nlmv5j"}))return Object.assign(t,{openOn:a.openOn||t.beforeOpen.doneData,cancelOn:a.cancelOn||t.beforeOpen.failData}),t;var n=e;return Object.assign(t,{openOn:effector.sample({and:[{clock:n.openOn}],or:{name:"openOn",sid:"o26601"}}),cancelOn:effector.sample({and:[{clock:n.cancelOn||effector.createEvent({name:"clock",sid:"-x23z00"})}],or:{name:"cancelOn",sid:"l2720p"}})}),t})(e),a=t.route,n=t.chainedRoute,o=t.beforeOpen,i=t.openOn,c=t.cancelOn,s=effector.createStore({},{name:"$params",sid:"-fpgvka"}),d=effector.createStore({},{name:"$query",sid:"y4h4ag"}),u=effector.combine({and:[effector.combine({and:[[a.$params,a.$query]],or:{name:"and",sid:"120e5z"}}),effector.combine({and:[[s,d]],or:{name:"and",sid:"12k6rc"}}),(e,r)=>e[0]===r[0]&&e[1]===r[1]],or:{name:"$hasSameParams",sid:"uvxnko"}}),l=effector.sample({and:[{clock:[a.opened,a.updated]}],or:{name:"routeTriggered",sid:"-o4rktf"}});effector.sample({and:[{clock:l,target:o}],or:{sid:"-qinkky"}}),s.on(l,((e,r)=>r.params)),d.on(l,((e,r)=>r.query)),effector.sample({and:[{clock:i,source:{params:s,query:d},filter:u,target:n.navigate}],or:{sid:"-q25qs4"}});var p=effector.merge([a.closed,c],{name:"aborted",sid:"e9ezkr"});return s.reset(p),d.reset(p),effector.sample({and:[{clock:p,target:n.closed}],or:{sid:"-piwy0h"}}),n},e.createHistoryRouter=e=>{var r=e.base,t=e.routes,n=e.notFoundRoute,o=e.hydrate,d=e.serialize,u=e.controls,l=u===void 0?effector.withFactory({sid:"-eby7",fn:()=>s(),name:"controls",method:"createRouterControls"}):u,p=effector.createStore(o!==null&&o!==void 0&&o,{and:{serialize:"ignore"},name:"$hydrateMode",sid:"-i2numw"}),f=((e,r)=>{r===void 0&&(r="");for(var t,n=[],o=()=>{var e,r=t.value;Array.isArray(r.route)?(e=n).push.apply(e,r.route.map((e=>a(a({},r),{},{route:e})))):n.push(r)},c=i(e);!(t=c()).done;)o();n=n.map((e=>a(a({},e),{},{path:""+r+e.path})));for(var s,d=[],u=[],l=i(n);!(s=l()).done;){var p=s.value;p.route.settings.derived?d.push(p):u.push(p)}if(d.length)for(var f,m=i(d);!(f=m()).done;)console.error("[Atomic-Router]: createHistoryRouter: "+f.value.path+" uses derived route. This won't work");return u})(t,r),h=effector.createEvent({name:"setHistory",sid:"wo9d0s"}),g=effector.createEvent({name:"navigateFromRouteTriggered",sid:"9zf2q7"}),O=effector.createEvent({name:"historyUpdated",sid:"-2drux"}),w=effector.createEvent({name:"recalculateTriggered",sid:"dwpshq"}),k=effector.createEvent({name:"recalculated",sid:"cnxs21"}),$=effector.createEvent({name:"routesMatched",sid:"-oym918"}),j=effector.createEvent({name:"routesMismatched",sid:"wtlio3"}),S=effector.createEvent({name:"routeNotFound",sid:"-co9rfg"}),P=effector.createEvent({name:"initialized",sid:"uzcs7d"}),A=effector.createStore("",{name:"$path",sid:"w0v7zo"}),T=effector.createStore({},{and:{name:"historyRouter.$query",updateFilter:(e,r)=>!c(e,r)},name:"$query",sid:"34mtvb"}),z=effector.createStore([],{and:{serialize:"ignore"},name:"$activeRoutes",sid:"-q9xrap"}),F=effector.createStore(null,{and:{serialize:"ignore"},name:"$history",sid:"jk9nd5"}),C=effector.createStore(!1,{name:"$isFirstCheckPassed",sid:"y4c34b"}),D=effector.createStore(!1,{name:"$isRouteNavigateInProgress",sid:"-6c2ssl"}),N=effector.attach({and:{source:F,effect:(e,r)=>E(a({history:e},r))},or:{name:"pushFx",sid:"gzjrp0"}}),U=effector.attach({and:{source:F,effect:e=>{var r=O;try{r=effector.scopeBind(O)}catch(e){}return e.listen((()=>{r()})),!0}},or:{name:"subscribeHistoryFx",sid:"5wp0bd"}}),H=effector.sample({and:[{clock:o?[O]:[O,U.done],source:F,filter:Boolean,fn:e=>{var r;return{path:e.location.pathname,query:(r=d===null||d===void 0?void 0:d.read(e.location.search))!==null&&r!==void 0?r:Object.fromEntries(new URLSearchParams(e.location.search))}}}],or:{name:"historyUpdatedParsed",sid:"fmwavu"}}),I=effector.sample({and:[{clock:H,source:{path:A,query:T},filter:(e,r)=>r.path!==e.path||!c(r.query,e.query),fn:(e,r)=>r}],or:{name:"historyUpdateTriggered",sid:"-qpa0p5"}});F.on(h,((e,r)=>r)),effector.sample({and:[{clock:F,target:U}],or:{sid:"rwilmr"}}),effector.sample({and:[{clock:I,source:F,filter:Boolean,fn:e=>{var r,t=e===null||e===void 0?void 0:e.location.hash;return{path:e===null||e===void 0?void 0:e.location.pathname,query:(r=d===null||d===void 0?void 0:d.read(e===null||e===void 0?void 0:e.location.search))!==null&&r!==void 0?r:Object.fromEntries(new URLSearchParams(e===null||e===void 0?void 0:e.location.search)),hash:t}},target:w}],or:{sid:"rz9klk"}});for(var M,L=i(f);!(M=L()).done;){var Q=M.value,B=$.filterMap(R(Q)),_=j.filterMap(R(Q)),W={initialized:effector.sample({and:[{clock:U.done,filter:effector.combine({and:[Q.route.$isOpened,p,(e,r)=>e&&!r],or:{name:"filter",sid:"gu94on"}})}],or:{name:"initialized",sid:"-gxdv2m"}}),opened:effector.sample({and:[{clock:B,filter:b(Q.route.$isOpened)}],or:{name:"opened",sid:"rd6yjz"}}),updated:effector.sample({and:[{clock:B,filter:Q.route.$isOpened}],or:{name:"updated",sid:"-owo90k"}}),closed:effector.sample({and:[{clock:_,filter:Q.route.$isOpened}],or:{name:"closed",sid:"ic5bp1"}})};effector.sample({and:[{clock:W.initialized,source:{params:Q.route.$params,query:Q.route.$query},target:Q.route.opened}],or:{sid:"-ue11fh"}}),effector.sample({and:[{clock:W.updated,source:[Q.route.$params,Q.route.$query],filter:(e,r)=>{var t=e[1];return!c(e[0],r.params)||!c(t,r.query)},fn:(e,r)=>r,target:Q.route.updated}],or:{sid:"-twzf1a"}}),effector.sample({and:[{clock:W.opened,filter:b(D),target:Q.route.opened}],or:{sid:"-tfe01q"}}),effector.sample({and:[{clock:W.closed,target:Q.route.closed}],or:{sid:"-taznau"}})}for(var K,G=()=>{var e=K.value;effector.sample({and:[{clock:e.route.navigate.doneData,fn:r=>{var t=r.replace;return{route:e,params:r.params,query:r.query,replace:t!==null&&t!==void 0&&t}},target:g}],or:{sid:"-suhti0"}})},J=i(f);!(K=J()).done;)G();D.on(g,(()=>!0)),effector.sample({and:[{clock:g,fn:e=>{var r=e.params,t=e.query,a=e.replace;return{path:m({pathCreator:e.route.path,params:r,query:t,serialize:d}),params:r,query:t,method:a?"replace":"push"}},target:N}],or:{sid:"-rzpcbi"}}),D.reset([$,j]),effector.sample({and:[{clock:w,fn:e=>{for(var r,t=e.path,a=e.query,n=e.hash,o=[],c=[],s=i(f);!(r=s()).done;){var d=r.value,u=d.path.includes("#")?""+t+n:""+t,l=v({pathCreator:d.path,actualPath:u});(l.matches?o:c).push({routeObj:d,params:l.params,query:a})}return c.forEach(((e,r)=>{o.some((r=>r.routeObj.route===e.routeObj.route))&&c.splice(r,1)})),{matching:o,mismatching:c.filter(Boolean),path:t,query:a}},target:k}],or:{sid:"-qzex5o"}}),A.on(I,((e,r)=>r.path)),T.on(I,((e,r)=>r.query));var V=k.map((e=>e.matching));return effector.sample({and:[{clock:V,filter:e=>e.length>0,target:$}],or:{sid:"-eosjhz"}}),effector.sample({and:[{clock:k.map((e=>e.mismatching)),filter:e=>e.length>0,target:j}],or:{sid:"-e9y3h8"}}),z.on(k,((e,r)=>r.matching.map((e=>e.routeObj.route)))),effector.sample({and:[{clock:V,filter:e=>e.length===0,target:S}],or:{sid:"-dscoho"}}),effector.withFactory({sid:"-dp1wu2",fn:()=>y(n),name:"none",method:"isRouteInternal"})&&(effector.sample({and:[{clock:S,source:T,filter:n.$isOpened,fn:e=>({query:e,params:{}}),target:n.updated}],or:{sid:"-doi4af"}}),effector.sample({and:[{clock:S,source:{query:T,isOpened:n.$isOpened},filter:e=>!e.isOpened,fn:e=>({query:e.query,params:{}}),target:n.opened}],or:{sid:"-d8k32y"}}),effector.sample({and:[{clock:V,source:n.$isOpened,filter:(e,r)=>e&&r.length>0,target:n.closed}],or:{sid:"-csm1vh"}})),effector.sample({and:[{clock:l.back,source:F,target:q}],or:{sid:"-cc484d"}}),effector.sample({and:[{clock:l.forward,source:F,target:x}],or:{sid:"-bx9s3m"}}),effector.sample({and:[{clock:T,source:{controlsQuery:l.$query,localQuery:T},filter:e=>!c(e.controlsQuery,e.localQuery),fn:e=>e.localQuery,target:l.$query}],or:{sid:"-btf7y3"}}),effector.sample({and:[{clock:l.$query,source:{path:A,localQuery:T,isNavigateInProgress:D,realHistory:F},filter:(e,r)=>{var t,a,n,o=e.localQuery,i=e.isNavigateInProgress,s=e.realHistory,u=(t=d===null||d===void 0?void 0:d.read((a=s===null||s===void 0?void 0:s.location.search)!==null&&a!==void 0?a:""))!==null&&t!==void 0?t:Object.fromEntries(new URLSearchParams((n=s===null||s===void 0?void 0:s.location.search)!==null&&n!==void 0?n:""));return i||!c(r,u)||!c(o,r)},fn:(e,r)=>{var t,a=e.path,n=(t=d===null||d===void 0?void 0:d.write(r))!==null&&t!==void 0?t:new URLSearchParams(r);return{path:a+(n?"?"+n:""),params:{},query:r,method:"push"}},target:N}],or:{sid:"-bdh6qm"}}),effector.sample({and:[{clock:k,source:{activeRoutes:z,path:A,query:T},filter:C.map((e=>!e)),target:P}],or:{sid:"-y1vb"}}),C.on(P,(()=>!0)).reset(F),{$path:A,$activeRoutes:z,$history:F,setHistory:h,$query:T,back:l.back,forward:l.forward,push:N,routes:f,initialized:P,routeNotFound:S}},e.createRoute=r,e.createRouterControls=s,e.isRoute=h,e.matchPath=v,e.querySync=e=>{var r,t,n,o=(r=(t=e.route)===null||t===void 0?void 0:t.$isOpened)!==null&&r!==void 0?r:effector.createStore(!0,{name:"$isOpened",sid:"-1sf5w3"}),c=effector.combine({and:[e.source],or:{name:"$source",sid:"-4puqls"}}),s=(n=e.clock)!==null&&n!==void 0?n:c,d="cleanup"in e?typeof e.cleanup=="boolean"?$[e.cleanup?"all":"none"]:a(a({},$.default),e.cleanup):$.default,u=effector.sample({and:[{clock:e.controls.$query,filter:o}],or:{name:"queryUpdatedFromHistory",sid:"7nbv4h"}});effector.sample({and:[{clock:s,source:effector.combine({and:[[c,e.controls.$query]],or:{name:"source",sid:"-4nk0xe"}}),filter:o,fn:e=>{var r=e[0],t=e[1],n={};if(d.irrelevant)for(var o,c=i(d.preserve);!(o=c()).done;){var s=o.value;s in t&&(n[s]=t[s])}else n=a({},t);for(var u in r)n[u]=r[u];if(d.empty)for(var l in r)d.preserve.includes(l)||n[l]||delete n[l];return n},target:e.controls.$query}],or:{sid:"ftvpyq"}});var l=r=>{var t=e.source[r];t.on(u,((e,a)=>{var n;return(n=a[r])!==null&&n!==void 0?n:t.defaultState}))};for(var p in e.source)l(p)},e.redirect=e=>{var r=e.clock?effector.sample({and:[{clock:e.clock}],or:{name:"clock",sid:"-f15r5p"}}):effector.createEvent({name:"clock",sid:"-f0lykc"}),t=O(e.params||{}),a=O(e.query||{}),n=O(e.replace||!1);return effector.sample({and:[{clock:r,source:{params:t,query:a,replace:n},fn:(e,r)=>{var t=e.params,a=e.query,n=e.replace;return{params:typeof t=="function"?t(r):t,query:typeof a=="function"?a(r):a,replace:typeof n=="function"?n(r):n}},target:e.route.navigate}],or:{sid:"a0n4fl"}}),r}}));
//# sourceMappingURL=atomic-router.umd.js.map
